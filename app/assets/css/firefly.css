.firefly-field {
  position: relative;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.firefly {
  position: absolute;
  width: var(--size);
  height: var(--size);
  border-radius: 50%;
  pointer-events: none;
  opacity: var(--opacity);

  background: var(--glow);
  box-shadow:
    0 0 6px var(--glow),
    0 0 14px color-mix(in srgb, var(--glow) 80%, white 20%),
    0 0 26px color-mix(in srgb, var(--glow) 70%, white 30%);

  animation:
    drift var(--duration) linear infinite var(--delay),
    fade var(--duration) ease-in-out infinite var(--delay),
    pulse 2.4s ease-in-out infinite;
}

/* Fallback for browsers without color-mix (e.g., older Safari) */
@supports not (color-mix(in srgb, white 50%, black 50%)) {
  .firefly {
    box-shadow:
      0 0 6px var(--glow),
      0 0 14px var(--glow),
      0 0 26px var(--glow);
  }
}

/* Only movement here */
@keyframes drift {
  0% {
    transform: translate3d(0, 0, 0);
  }
  25% {
    transform: translate3d(calc(var(--tx) * 0.3), calc(var(--ty) * 0.2), 0);
  }
  50% {
    transform: translate3d(calc(var(--tx) * 0.6), calc(var(--ty) * 0.7), 0);
  }
  75% {
    transform: translate3d(calc(var(--tx) * 0.9), calc(var(--ty) * 0.4), 0);
  }
  100% {
    transform: translate3d(var(--tx), var(--ty), 0);
  }
}

/* Fade in at start, fade out near the end */
@keyframes fade {
  0% {
    opacity: 0;
  }
  10% {
    opacity: var(--opacity);
  }
  90% {
    opacity: var(--opacity);
  }
  100% {
    opacity: 0;
  }
}

/* No transform here, just glow + opacity */
@keyframes pulse {
  0%,
  100% {
    box-shadow:
      0 0 4px var(--glow),
      0 0 10px #ffeb9a,
      0 0 18px #fff4c4;
  }
  50% {
    box-shadow:
      0 0 10px var(--glow),
      0 0 24px #ffeb9a,
      0 0 40px #fff4c4;
  }
}
